---
title: "Badass title like beta diversity change with logging !"
author: "Morgan Knoester & Sylvain Schmitt"
date: "October 12, 2016"
output: pdf_document
csl: mee.csl
bibliography: refs.bib
---

# Abstract

## Keywords

Beta-diversity, Selective logging, Tropical evergreen forest

# Introduction

Tropical logging accounts for one eighth of global timber production [@blaser11]. It represents a major threat to biodiversity. It has particularly increased over the **xth years [cite]**. Most tropical timber production originates from selective logging, the targeted harvesting of timber in a single cutting cycle. Others sylvicultural practices, such as tree removal by poisoning, are sometimes involved in selective logging.

The short-term negative impact of selective logging on biodiversity is well known **[cite]**, but less is known about the long term impact [@osazuwa15]. Moreover, even the short term impact on biodiversity is unclear, as sometimes short term increases can occur at low sylvicultural intensities [@martin15]. **More results about sylvicultural impact on biodiversity and beta-diversity more especially.**

- **Diversity measurement**
- **Diversity subsetting and $\beta$-diversity**
- **Tsallis entropy**

In this paper we designed communities from individuals with similar history. And we used $\beta$-diversity indices between those communities to address the following question: Does the floral composition turnover of logged forests differ from natural forests ?

# Material and methods

## Study site

The study was carried out in six 6.25-ha plots established in 1970 in Paracou research station ($5^\circ 18'N$ and $52^\circ 53'W$) in French Guiana. The six plots are divided in two categories: three logged plots, named T3, and three unlogged control plots. Selective felling for timber plus logging of non-commercial species of 40-50cm diameter at breast height (dbh) for fuelwood was realizedin logged plots in 1987. Additionaly, non-commercial species over 50cm dbh and commercial species with major defects were eliminated by poison-girdling. Selective logging in T3 plots resulted in 35 up to 56% of above ground biomass (AGB) loss **What about number of stem and species**. Mean rainfall is 3mm by month with mean annual temperature of $26^\circ C$ marked with a 4 month long dry season and a nearly 8 month rainy season interrupted by a short drier period. The forest is a lowland tropical rain forest with a dominance of Fabaceae, Chrysobalanaceae, Lecythidaceae and Sapotaceae.

## Floral composition

Before logging, each tree was identified with its vernacular name. Vernacular names can encompass different species and sometimes different genera. Since 1990, suvivors and recruited trees are being determined to the species level. Consequently tree removed in 1987 or tree that died before they could be categorically identified are not specifically defined. Subsequent analysis will then use vernacular names. Censuses represent 263 vernacular names.

## Analysis

### Time sampling

The inventories of all plots were conducted every year from 1984 to 1994 and every two years after 1995
on trees above 10 cm gbh. For subsequent analysis we replace missing years informations regarding rectuitments by the precedent years (n-1) in order to get correct turnover measurements.

### Community design

To study floral composition turnover we divided the plots into communities with similar history. We used logging year as the start date for both logged and unlogged plots. Trees which attain 10cm dbh after this date were defined as recruits (R) whereas trees which had 10cm dbh before this date were defined as survivors (S), both in logged and unlogged plots. In each census, recruits and survivors were divided in two communities: trees alive (A) and dead trees (D). We thus obtain 4 communities Alive Recruits (AR), Alive Survivors (AS), Dead Recruits (DR), and Dead Survivors (DS), for each census in both logged and unlogged plots (see $figure~1$).

We used this design to examine the evolution of floral composition between the start date and a given census. The floral composition at start date comprised alive and dead survivors (AS and DS). Whereas all tree alive at given census are alive recruits (AR) and alive survivors (AS). Thus to study floral composition turnover between start date and a given census, we need to compare alive recruits (AR) to dead survivors (DS).

![Community design. *Plots trees were separated in four communities being Alive Recruitments (AR), Alive Survivors (AS), Dead Recruitments (DR), and Dead Survivors (DS).*](Community.png)

### Diversity indices

**ADD CITATIONS**

Floral composition diversity of communties can be subset in different level of diversity. We choosed to use $\beta$-diversity, being the supplementary information obtain by knowing each community composition compare to the mean community composition ($\alpha$-diversity). We more specifically used the Shannon diversity index. Shannon index, is an order 1 diversity index, giving a trade-off between the measurement of richness and eveness in floral composition. Shannon index of $\beta$-diversity was calculated with Tsallis generalized entropy formula [@marcon14b], and its exponential, with the following equations :

$$^1 H_{\beta}  = \sum_{i}{w_{i} \sum_{s}{{p_{si} ~ ln \frac{p_{si}}{p_{s}} } }} ~~ and ~~  ^1 D_{\beta} = e^{ ^1 H_{\beta}} $$
with $^1 H_{\beta}$ the $\beta$-entropy and $^1 D_{\beta}$ the $\beta$-diversity of order 1 (Shannon) for $i$ communities of weights $w_{i}$ containing $s$ species of probability $p_{si}$ in the community $i$ and probability $p_{s}$ in the metacommunity.

Bias was reduced using the best transformation following recommandations from @marcon14a.

All analyses were conducted using the R 3.3.0  software environment [@R] with entropart package [@entropart].

# Results

```{r config, message=FALSE, warning=FALSE, include=FALSE}
rm(list = ls()) ; invisible(gc())
library(knitr)
library(parallel)
cores <- detectCores() - 1
library(Paracou)
opts_chunk$set( echo = F, message = F, warning = F, include = F, fig.height = 8, fig.width = 8, cache = T, cache.lazy = F)
```

```{r tree opening}
tree <- data.table::fread('~/Documents/BIOGET/Projet/Paracou/inst/extdata/paracou_p1_15.csv', data.table = F)

# Extracting interest data
tree <- tree[c('n_parcelle', 'i_arbre', 'nomPilote', 'campagne', 'Genre', 'espece', 'code_vivant')]
names(tree) <- c('plot', 'id', 'vern', 'census', 'genus', 'species', 'alive')

# Treatment
tree$treatment <- NA
tree$treatment[which(tree$plot %in% c(1, 6, 11))] <- 0 # Unlogged
tree$treatment[which(tree$plot %in% c(2, 7, 9))] <- 1 # T1
tree$treatment[which(tree$plot %in% c(3, 5, 10))] <- 2 # T2
tree$treatment[which(tree$plot %in% c(4, 8, 12))] <- 3 # T3
```

```{r bd Job}
bd <- tree[which(!duplicated(tree$id)), c('id', 'treatment', 'plot', 'vern', 'genus', 'species')]
bd <- merge(bd, tree[which(tree$alive == 'FAUX'), c('id', 'census')], all.x = T)
names(bd)[7] <- 'death'
# Missing years
bad_years <- c(1996, 1998, 2000, 2002, 2004, 2006)
age <- table(tree[-which(tree$alive == 'FAUX'),'id'], tree[-which(tree$alive == 'FAUX'),'census'])
age <- as.data.frame.matrix(age) 
age[as.character(bad_years)] <- age[as.character(bad_years - 1)]
age <- rowSums(age) - 1
age <- data.frame(id = names(age), age = age)
bd <- merge(bd, age)
sel <- which(is.na(bd$death))
bd$birth <- NA 
bd$birth[-sel] <- bd$death[-sel] - bd$age[-sel]
bd$birth[sel] <- 2015 - bd$age[sel]
bd <- bd[which(!duplicated(bd$id)),]
row.names(bd) <- bd$id
```

```{r diversity}
library(entropart)
years <- c(1988:2015)
diversity <- sapply(years, function(y){
  
  # Attributing communities
  bd_y <- bd
  bd_y$com <- com(tree, bd_y, y, 1987)
  if(length(which(is.na(bd_y$com))) > 0){
    bd_y <- bd_y[-which(is.na(bd_y$com)),] 
  }
  
  # Building lists of treatment and repetition
  Coms <- list(L = subset(bd_y, treatment == 0), 
               UL = subset(bd_y, treatment == 3))
  Coms$L <- list(P1 = subset(Coms$L, plot == 1),
                 P6 = subset(Coms$L, plot == 6),
                 P11 = subset(Coms$L, plot == 11))
  Coms$UL <- list(P4 = subset(Coms$UL, plot == 4),
                  P8 = subset(Coms$UL, plot == 8),
                  P12 = subset(Coms$UL, plot == 12))
  
  # Extracting searched beta-diversities
  ## UL.DS.AR
  UL.df <- lapply(Coms$UL, function(x) {with(x, as.data.frame.matrix(table(vern, com)))})
  UL.mc <- lapply(UL.df, function(x) {MetaCommunity(x[c('DS', 'AR')])})
  UL.DS.AR <- lapply(UL.mc, function(x){BetaDiversity(x)$Total})
  ## L.DS.AR
  L.df <- lapply(Coms$L, function(x) {with(x, as.data.frame.matrix(table(vern, com)))})
  L.mc <- lapply(L.df, function(x) {MetaCommunity(x[c('DS', 'AR')])})
  L.DS.AR <- lapply(L.mc, function(x){BetaDiversity(x)$Total})
  
  return(list(
    UL.DS.AR = UL.DS.AR,
    L.DS.AR = L.DS.AR
  ))
}, simplify = F)

names(diversity) <- years
diversity <- lapply(diversity, `[`, names(diversity[[1]]))
diversity <- apply(do.call(rbind, diversity), 2, as.list)
diversity <- lapply(diversity, function(x){do.call('rbind', lapply(x, rbind))})
diversity <- lapply(diversity, function(x){row.names(x) <- years ; return(x)})
diversity <- lapply(diversity, data.frame)
```

```{r plot, include=TRUE}
library(ggplot2)

# data
diversity <- lapply(diversity, function(x){
  data.frame(apply(x, 2, as.numeric), row.names = years)
  })
diversity.stats <- lapply(diversity, function(x){
  data.frame(year = years,
             mean = apply(x, 1, mean, na.rm = T),
             se = apply(x, 1, function(x){sd(x, na.rm = T) / sqrt(length(x))}))
})
diversity.stats <- do.call('rbind', diversity.stats)
diversity.stats$coms <- as.factor(rep(names(diversity), each = length(years)))

# plot
ggplot(diversity.stats, aes(x = year, y = mean, colour = coms)) + 
  geom_errorbar(aes(ymin = mean - se, ymax = mean + se), 
                colour = "black", width=.1) +
  geom_line() +
  geom_point(size=2, shape=21, fill="white") +
  xlab('year') +
  ylab('Beta-diversity (Shannon index)') +
  scale_colour_hue(name="Beta-diversity index",
                   breaks=c("UL.DS.AR","L.DS.AR"),
                   labels=c("AR and DS in Unlogged",
                            "AR and DS in Logged"),
                   l=40) +
  expand_limits(y=1) +
  theme_bw() +
  theme(legend.justification = c(1,1),
        legend.position = c(1,1))
```

Figure 2: Beta-diversity indices evolution after logging. *Beta-diversity was measured with Shannon beta-diversity from Tsallis entropy between alive recruits (AR) and dead survivors (DS) in unlogged (UL) plots represented by blue line and in logged (L) plots represented by red line. Vertical bars represents the standard errors.*

# Discussion

# *Acknowledgements*

Ariane, Camille, Bruno for guiding. Pascal and all poeple who have contributed to Paracou data collect during all the past years. Tim for english useful comments.

# References
