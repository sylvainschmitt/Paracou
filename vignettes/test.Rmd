---
title: "Badass title like beta diversity change with logging !"
author: "Morgan Knoester & Sylvain Schmitt"
date: "October 12, 2016"
output: pdf_document
---

# Introduction

- Selective logging
    - What is selective logging
    - Increased used in tropical forest
- Sylviculture impact diversity *Gibson et al, 2011*
    - What’s the impact of selective logging
    - What’s the impact of complementary silvicultural practices
- Long term study
    - Selective logging clear short term impact
    - What about the long term impact
    - Evolution in time
- Succession
    - Evolution in time
    - Passage par des stades temporaires (héliophile ou autres)
    - Increase of diversity
    - Toward a climax / equilibrium / stable turn over
- Question of the article :
    - Turn over unlogged ? DS # AR
    - Logged plot toward origin ? AR # AS + DS
    - Stades successions temporaires ? DR # AR *(NR aucun intérèt)*
- Qu’est ce que c’est qu’on fait
    - On fait des communautés à partir de groupes d’individus pour répondre aux 3 questions précédentes
    - On utilise des indices de diversité bêta pour comparer ces communautés

# Material and methods

## Study site

## Taxonomic composition

## Analysis

### Time sampling

### Community design

### Diversity indices

```{r config, message=FALSE, warning=FALSE, include=FALSE}
rm(list = ls()) ; invisible(gc())
library(knitr)
library(parallel)
cores <- detectCores() - 1
library(Paracou)
opts_chunk$set(
  echo = F, message = F, warning = F, fig.height = 8, fig.width = 8, cache = T, eval = F, cache.lazy = F)
```

```{r tree opening}
tree <- data.table::fread('~/Documents/BIOGET/Projet/Paracou/inst/extdata/paracou_p1_15.csv', data.table = F)

# Extracting interest data
tree <- tree[c('n_parcelle', 'i_arbre', 'nomPilote', 'campagne', 'Genre', 'espece', 'code_vivant')]
names(tree) <- c('plot', 'id', 'vern', 'census', 'genus', 'species', 'alive')

# Treatment
tree$treatment <- NA
tree$treatment[which(tree$plot %in% c(1, 6, 11))] <- 0 # Unlogged
tree$treatment[which(tree$plot %in% c(2, 7, 9))] <- 1 # T1
tree$treatment[which(tree$plot %in% c(3, 5, 10))] <- 2 # T2
tree$treatment[which(tree$plot %in% c(4, 8, 12))] <- 3 # T3
```

```{r bd Job}
bd <- tree[which(!duplicated(tree$id)), c('id', 'treatment', 'plot', 'vern', 'genus', 'species')]
bd <- merge(bd, tree[which(tree$alive == 'FAUX'), c('id', 'census')], all.x = T)
names(bd)[7] <- 'death'

# Annees de merde
bad_years <- c(1996, 1998, 2000, 2002, 2004, 2006)
age <- table(tree[-which(tree$alive == 'FAUX'),'id'], tree[-which(tree$alive == 'FAUX'),'census'])
age <- as.data.frame.matrix(age) 
age[as.character(bad_years)] <- age[as.character(bad_years - 1)]
age <- rowSums(age) - 1
age <- data.frame(id = names(age), age = age)
bd <- merge(bd, age)
sel <- which(is.na(bd$death))
bd$birth <- NA 
bd$birth[-sel] <- bd$death[-sel] - bd$age[-sel]
bd$birth[sel] <- 2015 - bd$age[sel]
bd <- bd[which(!duplicated(bd$id)),]
row.names(bd) <- bd$id
```

```{r diversity}
years <- unique(tree$census)[order(unique(tree$census))][-1]
alphaUL <- sapply(years, function(y){
  bd_y <- bd
  bd_y$com <- com(tree, bd_y, y, 1987)
  if(length(which(is.na(bd_y$com))) > 0){
    bd_y <- bd_y[-which(is.na(bd_y$com)),] 
  }
  UL <- subset(bd_y, treatment == 3)
  UL.df <- table(UL$vern, UL$com)
  UL.df[UL.df > 0] <- 1
  MC <- entropart::MetaCommunity(UL.df)
  return(colSums(UL.df))
})

alphaUL <- data.frame(data.table::rbindlist(lapply(alphaUL, function(x){
  data.frame(t(x))
}), fill = T))
row.names(alphaUL) <- years
alphaUL[is.na(alphaUL)] <- 0
```

```{r plot}
plot(alphaUL$AR ~ row.names(alphaUL), pch = '', ylab = '', xlab = 'year', main = 'Alpha diversity unlogged')
lines(alphaUL$AR ~ row.names(alphaUL), col = 'green', lty = 1)
lines(alphaUL$DR ~ row.names(alphaUL), col = 'green', lty = 2)
lines(alphaUL$AS ~ row.names(alphaUL), col = 'blue', lty = 1)
lines(alphaUL$DS ~ row.names(alphaUL), col = 'blue', lty = 2)
legend('bottomright', c('AR', 'DR', 'AS', 'DS'), col = c('green', 'green', 'blue', 'blue'), lty = c(1, 2, 1, 2))
```

```{r beta}
library(entropart)
years <- c(1988:2015)
betaUL <- sapply(years, function(y){
  bd_y <- bd
  bd_y$com <- com(tree, bd_y, y, 1987)
  if(length(which(is.na(bd_y$com))) > 0){
    bd_y <- bd_y[-which(is.na(bd_y$com)),] 
  }
  UL <- subset(bd_y, treatment == 0)
  UL.df <- as.data.frame.matrix(table(UL$vern, UL$com))
  UL.mc <- MetaCommunity(UL.df[c('DS', 'AR')])
  return(BetaDiversity(UL.mc)$Total)
})

betaUL <- data.frame(DS.AR = betaUL)
row.names(betaUL) <- years
```

```{r beta plot}
plot(betaUL$DS.AR ~ row.names(betaUL), ylab = '', xlab = 'year', main = 'Beta diversity DS vs. AR unlogged')
```

